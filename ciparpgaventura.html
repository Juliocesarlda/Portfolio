<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MISS√ÉO DANO ZERO - Amcor</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

        @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        /* --- ESTILOS DO LOADING SCANNER --- */
        #loading-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle, #001a33 0%, #000000 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000000;
            color: #5de6ff;
            font-family: 'Montserrat', sans-serif;
        }

        .scanner-container { text-align: center; }

        .scanner-box {
            position: relative;
            width: 250px;
            height: 150px;
            border: 2px solid #5de6ff;
            background: rgba(93, 230, 255, 0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin: 20px auto;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(93, 230, 255, 0.2);
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #5de6ff;
            box-shadow: 0 0 15px #5de6ff, 0 0 5px #fff;
            top: 0;
            animation: scan-move 2s infinite ease-in-out;
        }

        #scan-icon { font-size: 40px; margin-bottom: 10px; }
        #scan-text { font-weight: bold; letter-spacing: 2px; font-size: 14px; }

        #scan-status-container {
            width: 250px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto;
        }

        #scan-status-bar {
            width: 0%;
            height: 100%;
            background: #5de6ff;
            box-shadow: 0 0 10px #5de6ff;
            transition: width 0.3s;
        }

        @keyframes scan-move {
            0% { top: 0%; }
            50% { top: 100%; }
            100% { top: 0%; }
        }

        /* --- ANIMA√á√ÉO DE ERRO --- */
        .flash-error {
            animation: flash-red 0.5s ease-in-out;
        }

        @keyframes flash-red {
            0% { background-color: #f0f0f0; }
            50% { background-color: rgba(229, 0, 43, 0.5); }
            100% { background-color: #f0f0f0; }
        }

        /* --- ESTILOS DO JOGO --- */
        :root {
            --amcor-blue: #004d99;
            --amcor-red: #e5002b;
            --color-correct: #4CAF50;
            --color-incorrect: #f44336;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #game-container {
            width: 100%; 
            max-width: 1100px;
            background-color: #ffffff;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background-color: var(--amcor-blue);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        #status-bar { display: flex; gap: 20px; align-items: center; font-weight: bold; }

        #health-bar-container {
            width: 130px; height: 18px;
            background-color: rgba(255,255,255,0.3);
            border-radius: 10px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        #health-bar {
            height: 100%; background-color: var(--color-correct);
            transition: width 0.5s ease; font-size: 0.8em;
            text-align: center; line-height: 18px; color: white;
        }

        main { padding: 30px; display: grid; grid-template-columns: 1fr; gap: 30px; }
        @media (min-width: 850px) { main { grid-template-columns: 1fr 320px; } }

        /* PAINEL DE INVENT√ÅRIO (ESCONDIDO POR PADR√ÉO) */
        #inventory-panel {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #ddd;
        }

        #inventory-panel.visible {
            opacity: 1;
            pointer-events: auto;
        }

        #epi-explanation {
            margin-bottom: 20px; padding: 18px; background: #f8f9fa;
            border-left: 5px solid var(--amcor-blue); border-radius: 8px;
            font-size: 0.95em; line-height: 1.5; min-height: 80px;
        }

        .explanation-popup {
            background: #e3f2fd;
            border: 2px solid var(--amcor-blue);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            animation: slideUp 0.5s ease-out;
            text-align: left;
            color: #333;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .epi-item {
            width: 70px; height: 70px; cursor: pointer;
            border: 3px solid #eee; border-radius: 12px;
            padding: 5px; transition: all 0.2s; background: white; object-fit: contain;
        }
        .epi-item:hover { transform: scale(1.1); border-color: var(--amcor-blue); }
        .correct { border-color: var(--color-correct) !important; box-shadow: 0 0 15px var(--color-correct); }
        .incorrect { border-color: var(--color-incorrect) !important; box-shadow: 0 0 15px var(--color-incorrect); }

        .choice-button {
            display: block; width: 100%; padding: 16px; margin: 12px 0;
            background: #fff; border: 2px solid #ddd; border-radius: 12px;
            cursor: pointer; font-weight: 600; font-family: 'Montserrat', sans-serif;
        }

        .btn-action {
            background-color: var(--amcor-red); color: white;
            padding: 18px 40px; border: none; border-radius: 50px;
            font-weight: bold; cursor: pointer; text-transform: uppercase;
        }

        #feedback-area { min-height: 50px; margin-top: 20px; font-weight: bold; }
        .correct-text { color: var(--color-correct); background: #e8f5e9; padding: 10px; border-radius: 8px; }
        .incorrect-text { color: var(--amcor-red); background: #ffebee; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="intro-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000 url('missaodanozero.png') no-repeat center center; background-size: contain; z-index: 3000000; cursor: pointer; display: flex; justify-content: center; align-items: flex-end;">
        <p style="color: white; font-family: 'Montserrat', sans-serif; margin-bottom: 30px; text-shadow: 2px 2px 10px #000; font-weight: bold; animation: pulse 1.5s infinite;">CLIQUE PARA INICIAR</p>
    </div>

    <div id="loading-screen">
        <div class="scanner-container">
            <div id="start-scan-wrapper">
                <button id="btn-iniciar-scan" class="btn-action" style="background-color: #5de6ff; color: #000; box-shadow: 0 0 20px #5de6ff;">
                    INICIAR SCANNER DE EPIs üõ°Ô∏è
                </button>
            </div>
            <div id="scanner-main-content" style="display: none;">
                <div class="scanner-box">
                    <div class="scan-line"></div>
                    <div class="scanner-content">
                        <span id="scan-icon">üõ°Ô∏è</span>
                        <p id="scan-text">INICIALIZANDO...</p>
                    </div>
                </div>
                <div id="scan-status-container">
                    <div id="scan-status-bar"></div>
                </div>
            </div>
            <p style="font-size: 10px; margin-top: 15px; opacity: 0.7; color: #5de6ff;">SISTEMA DE SEGURAN√áA AMCOR v2.0</p>
        </div>
    </div>

    <audio id="som-loading" src="carregandomissaodanozero.mp3" loop></audio>
    <audio id="som-clique-start" src="https://codeskulptor-demos.commondatastorage.googleapis.com/descent/gotitem.mp3"></audio>

    <div id="game-container">
        <header>
            <h1>üõ°Ô∏è Amcor Miss√£o Dano Zero</h1>
            <div id="status-bar">
                <span id="day-display">Dia 0/10</span>
                <div id="health-bar-container">
                    <div id="health-bar" style="width: 100%;">100%</div>
                </div>
                <span id="score-display">0 pts</span>
            </div>
        </header>

        <main id="game-area">
            <div id="scenario-display">
                <h2>Bem-vindo √† Jornada!</h2>
                <p>Seu objetivo √© completar 10 dias de turno mantendo sua <strong>Sa√∫de (HP) acima de 90%</strong>.</p>
                <p>Clique nos EPIs ao lado para conhecer suas fun√ß√µes antes de come√ßar.</p>
                <br>
                <button class="btn-action" id="start-button">Iniciar 1¬∫ Dia</button>
            </div>

            <div id="inventory-panel">
                <div id="epi-explanation-wrapper">
                    <h3 style="margin-top:0">Dica do Especialista</h3>
                    <div id="epi-explanation">Clique em um equipamento para ver sua import√¢ncia t√©cnica aqui antes de come√ßar.</div>
                </div>
                
                <h3>Seu Invent√°rio</h3>
                <div id="inventory-items" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <img src="luvaanticorte.png" class="epi-item" data-epi-id="luva-anticorte" title="Luva Anticorte">
                    <img src="luvalatex.jpg" class="epi-item" data-epi-id="luva-latex" title="Luva Latex">
                    <img src="oculosamplavisao.webp" class="epi-item" data-epi-id="oculos-ampla" title="Ampla Vis√£o">
                    <img src="oculosdeseguranca.jpg" class="epi-item" data-epi-id="oculos-seguranca" title="√ìculos Seguran√ßa">
                    <img src="bonecasquete.webp" class="epi-item" data-epi-id="bone-casquete" title="Bon√© Casquete">
                    <img src="luvamangote.jpg" class="epi-item" data-epi-id="mangote" title="Mangote">
                </div>
                <div id="feedback-area"></div>
            </div>
        </main>
    </div>

    <a href="https://api.whatsapp.com/send?phone=5543920029039&text=Bug%20Report:" target="_blank" style="position:fixed; bottom:20px; right:20px; background:#25D366; color:white; padding:12px 20px; border-radius:50px; text-decoration:none; font-family:sans-serif; font-weight:bold; font-size:14px; z-index:10000; display:flex; align-items:center; gap:8px;">
        <span>REPORTAR ERROS OU ENVIAR SUGEST√ïES</span> üêõ
    </a>

<script>
    const audioErro = new Audio('errou.mp3'); 
    const audioAcerto = new Audio('acertou.mp3'); 
    let state = { day: 1, hp: 100, score: 0, current: null, gameActive: false, questionsRemaining: [] };

    const epiKnowledge = {
        "luva-anticorte": { title: "üß§ Luva Anticorte", text: "Prote√ß√£o mec√¢nica essencial para manuseio de l√¢minas e bordas de bobinas." },
        "luva-latex": { title: "üß™ Luva-latex", text: "Imperme√°vel contra solventes e agentes corrosivos." },
        "oculos-ampla": { title: "ü•Ω √ìculos Ampla Vis√£o", text: "Veda√ß√£o total contra respingos l√≠quidos e vapores qu√≠micos." },
        "oculos-seguranca": { title: "üëì √ìculos de Seguran√ßa", text: "Prote√ß√£o frontal contra proje√ß√£o de part√≠culas s√≥lidas." },
        "bone-casquete": { title: "üß¢ Bon√© Casquete", text: "Protege o cr√¢nio contra impactos em objetos fixos e quinas." },
        "mangote": { title: "üõ°Ô∏è Mangote de Prote√ß√£o", text: "Protege o antebra√ßo contra cortes e abras√£o." }
    };

    const situationPool = [
        { id: 'S1', type: "multiple-choice", title: "Prioridade Amcor", description: "O supervisor pede pressa e sugere pular o Intervalo de Seguran√ßa. O que fazer?", choices: [{ text: "Acelerar produ√ß√£o.", isCorrect: false }, { text: "Fazer o Intervalo de Seguran√ßa.", isCorrect: true }], successMessage: "Correto! Seguran√ßa em 1¬∫ lugar.", failMessage: "Errado! Produ√ß√£o n√£o justifica riscos. HP -10" },
        { id: 'S2', type: "epi", title: "Corte de Filme", description: "Voc√™ vai realizar o corte lateral de uma bobina. Qual o EPI Vital para as m√£os?", correctEPI: "luva-anticorte", successMessage: "Certo! M√£os protegidas contra cortes.", failMessage: "Risco de corte! O EPI correto era a Luva Anticorte. HP -10" },
        { id: 'S3', type: "multiple-choice", title: "Bloqueio LOTO", description: "Ap√≥s bloquear as energias em uma manuten√ß√£o, qual o pr√≥ximo passo obrigat√≥rio?", choices: [{ text: "Iniciar o trabalho.", isCorrect: false }, { text: "Testar Energia Zero.", isCorrect: true }], successMessage: "Seguro! Energia Zero confirmada.", failMessage: "Perigo! Sempre teste o zero antes de tocar na m√°quina. HP -15" },
        { id: 'S4', type: "epi", title: "Troca de Cilindro", description: "Voc√™ precisa trocar um cilindro pesado e h√° risco de bater a cabe√ßa em partes baixas da m√°quina. O que usar?", correctEPI: "bone-casquete", successMessage: "Boa! O casquete protege contra impactos em objetos fixos.", failMessage: "Cuidado! Bater a cabe√ßa pode ser fatal. Use o Casquete. HP -10" },
        { id: 'S5', type: "multiple-choice", title: "Postura Ergon√¥mica", description: "Ao levantar uma caixa pesada do ch√£o, qual a postura correta?", choices: [{ text: "Dobrar a coluna.", isCorrect: false }, { text: "Dobrar os joelhos e manter a coluna reta.", isCorrect: true }], successMessage: "Correto! Preserve sua coluna.", failMessage: "Errado! Isso causa les√µes graves na lombar. HP -10" },
        { id: 'S6', type: "epi", title: "Limpeza de Clich√™", description: "Voc√™ usar√° solventes para limpar as chapas de impress√£o. Qual prote√ß√£o ocular veda contra vapores e respingos?", correctEPI: "oculos-ampla", successMessage: "Perfeito! A veda√ß√£o 360¬∫ protege contra respingos qu√≠micos.", failMessage: "Risco qu√≠mico! √ìculos comuns n√£o vedam contra vapores. HP -15" },
        { id: 'S7', type: "multiple-choice", title: "√Årea de Empilhadeiras", description: "Voc√™ est√° atravessando a f√°brica e uma empilhadeira se aproxima. Qual o procedimento?", choices: [{ text: "Manter contato visual com o operador e esperar.", isCorrect: true }, { text: "Passar correndo na frente dela.", isCorrect: false }], successMessage: "Seguro! O contato visual garante que voc√™ foi visto.", failMessage: "Perigo! Jamais presuma que o operador te viu. HP -20" },
        { id: 'S8', type: "epi", title: "Abastecimento de Tinta", description: "Ao despejar tinta l√≠quida no balde, h√° risco de respingos qu√≠micos nos bra√ßos. O que usar?", correctEPI: "mangote", successMessage: "Correto! O mangote protege seus antebra√ßos contra absor√ß√£o qu√≠mica.", failMessage: "Aten√ß√£o! Sua pele absorve contaminantes. Use o Mangote. HP -10" },
        { id: 'S9', type: "multiple-choice", title: "Derramamento", description: "Voc√™ encontrou um pequeno vazamento de √≥leo no piso. O que fazer imediatamente?", choices: [{ text: "Sinalizar a √°rea e limpar o local.", isCorrect: true }, { text: "Ignorar, pois n√£o foi voc√™ quem sujou.", isCorrect: false }], successMessage: "Atitude Proativa! Evitou uma queda.", failMessage: "Risco de queda! √ìleo no ch√£o √© um perigo cr√≠tico. HP -10" },
        { id: 'S10', type: "epi", title: "Prepara√ß√£o Qu√≠mica", description: "Voc√™ vai misturar aditivos qu√≠micos que podem causar dermatite em contato direto. Qual a luva certa?", correctEPI: "luva-latex", successMessage: "Isso a√≠! Luvas imperme√°veis para prote√ß√£o qu√≠mica.", failMessage: "Queimadura qu√≠mica! Luvas de pano n√£o protegem contra l√≠quidos. HP -10" }
    ];

    document.getElementById('start-button').onclick = startGame;

    // --- L√ìGICA DE VISIBILIDADE DO INVENT√ÅRIO ---
    function toggleInventory(show) {
        const panel = document.getElementById('inventory-panel');
        if(show) {
            panel.classList.add('visible');
        } else {
            panel.classList.remove('visible');
        }
    }

    function startGame() {
        document.getElementById('som-clique-start').play();
        state.gameActive = true;
        state.day = 1; state.hp = 100; state.score = 0;
        state.questionsRemaining = [...situationPool].sort(() => Math.random() - 0.5);
        document.getElementById('epi-explanation-wrapper').style.display = 'none'; 
        
        // Antes do jogo come√ßar, o invent√°rio √© vis√≠vel para estudo. Ao dar start, ele some at√© ser necess√°rio.
        toggleInventory(false); 
        updateUI();
        nextSituation();
    }

    function nextSituation() {
        if (state.hp <= 0) return end(false);
        if (state.day > 10) return end(true);
        if (state.questionsRemaining.length === 0) state.questionsRemaining = [...situationPool].sort(() => Math.random() - 0.5);
        
        state.current = state.questionsRemaining.shift(); 
        
        document.querySelectorAll('.epi-item').forEach(img => img.classList.remove('correct', 'incorrect'));
        
        // --- MOSTRA OU ESCONDE BASEADO NA PERGUNTA ---
        toggleInventory(state.current.type === 'epi');
        
        renderSituation();
    }

    function renderSituation() {
        const s = state.current;
        let html = `<h2>Dia ${state.day}/10</h2><p><strong>${s.title}</strong></p><p>${s.description}</p>`;
        if (s.type === 'multiple-choice') {
            s.choices.forEach(c => {
                html += `<button class="choice-button" onclick="evaluateChoice(${c.isCorrect})">${c.text}</button>`;
            });
        } else {
            html += `<p style="color:var(--amcor-red); font-weight:bold; animation: pulse 1s infinite;">‚ö†Ô∏è SELECIONE O EPI NO PAINEL DE INVENTARIO!</p>`;
            enableEPISelection();
        }
        document.getElementById('scenario-display').innerHTML = html;
        document.getElementById('feedback-area').innerHTML = '';
    }

    function lancarConfetes() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#004d99', '#e5002b', '#ffffff', '#5de6ff'] });
    }

    function evaluateChoice(isCorrect, element = null) {
        const feedback = document.getElementById('feedback-area');
        disableAll();
        let infoHTML = '';
        
        // Se for pergunta de EPI, mostramos a explica√ß√£o no feedback e mantemos o painel vis√≠vel para ver o efeito.
        if (state.current.type === 'epi') {
            const info = epiKnowledge[state.current.correctEPI];
            infoHTML = `<div class="explanation-popup"><strong>üí° DICA T√âCNICA:</strong><br>${info.title}: ${info.text}</div>`;
        }

        if (isCorrect) {
            state.score += 20;
            if (element) element.classList.add('correct');
            audioAcerto.currentTime = 0; audioAcerto.play().catch(() => {}); 
            lancarConfetes();
            feedback.innerHTML = `<div class="correct-text">‚úî ${state.current.successMessage}</div>${infoHTML}`;
        } else {
            state.hp -= 10;
            if (element) element.classList.add('incorrect');
            audioErro.currentTime = 0; audioErro.play().catch(() => {});
            feedback.innerHTML = `<div class="incorrect-text">‚úò ${state.current.failMessage}</div>${infoHTML}`;
            document.body.classList.add('flash-error');
            setTimeout(() => document.body.classList.remove('flash-error'), 500);
        }
        
        state.day++;
        updateUI();
        
        // Ap√≥s 5 segundos, esconde o invent√°rio para a pr√≥xima rodada (se for m√∫ltipla escolha)
        setTimeout(() => {
            toggleInventory(false);
            nextSituation();
        }, 5000); 
    }

    function updateUI() {
        document.getElementById('day-display').innerText = `Dia ${Math.min(state.day, 10)}/10`;
        document.getElementById('score-display').innerText = `${state.score} pts`;
        const hb = document.getElementById('health-bar');
        hb.style.width = `${state.hp}%`;
        hb.innerText = `${state.hp}%`;
        hb.style.backgroundColor = state.hp > 60 ? 'var(--color-correct)' : (state.hp > 30 ? '#ffc107' : 'var(--amcor-red)');
    }

    function enableEPISelection() {
        document.querySelectorAll('.epi-item').forEach(img => {
            img.onclick = () => evaluateChoice(img.dataset.epiId === state.current.correctEPI, img);
        });
    }

    // Estudo inicial (antes do jogo)
    document.querySelectorAll('.epi-item').forEach(img => {
        img.addEventListener('click', () => {
            if(!state.gameActive) {
                const info = epiKnowledge[img.dataset.epiId];
                document.getElementById('epi-explanation').innerHTML = `<strong>${info.title}</strong><br>${info.text}`;
            }
        });
        // Garante que o invent√°rio esteja vis√≠vel na tela inicial para estudo
        document.getElementById('inventory-panel').classList.add('visible');
        document.getElementById('inventory-panel').style.pointerEvents = "auto";
    });

    function disableAll() {
        document.querySelectorAll('.epi-item').forEach(i => i.onclick = null);
        document.querySelectorAll('.choice-button').forEach(b => b.disabled = true);
    }

    function end(won) {
        toggleInventory(false);
        const result = won && state.hp >= 90 ? "üèÜ GUARDI√ÉO AMCOR" : (won ? "‚úÖ CONCLU√çDO" : "‚ùå TENTE NOVAMENTE");
        if(won && state.hp >= 90) lancarConfetes(); 
        document.getElementById('game-area').innerHTML = `
            <div style="text-align:center; padding:40px;">
                <h1>${result}</h1>
                <p>HP Final: ${state.hp}% | Pontos: ${state.score}</p>
                <button class="btn-action" onclick="window.location.reload()">Recome√ßar</button>
            </div>`;
    }

    // --- L√ìGICA DE √ÅUDIO E TRANSI√á√ÉO ---
    const introScreen = document.getElementById('intro-screen');
    const somIntroducao = new Audio('missaodanozero.mp3'); 
    let introFinalizada = false;

    function finalizarIntro() {
        if (introFinalizada) return;
        introFinalizada = true;
        introScreen.style.transition = "opacity 0.8s";
        introScreen.style.opacity = "0";
        setTimeout(() => { introScreen.style.display = "none"; }, 800);
    }

    introScreen.addEventListener('click', () => {
        somIntroducao.play().catch(() => {});
        finalizarIntro();
    });

    window.addEventListener('load', function() {
        const btnIniciar = document.getElementById('btn-iniciar-scan');
        const somLoading = document.getElementById('som-loading');
        btnIniciar.onclick = function() {
            document.getElementById('start-scan-wrapper').style.display = 'none';
            document.getElementById('scanner-main-content').style.display = 'block';
            if(somLoading) { somLoading.volume = 0.4; somLoading.play().catch(() => {}); }
            let step = 0;
            const etapas = [{p:25, t:"CONECTANDO..."}, {p:50, t:"LENDO EPIs..."}, {p:75, t:"SISTEMA AMCOR..."}, {p:100, t:"PRONTO!"}];
            const interval = setInterval(() => {
                if(step < etapas.length){
                    document.getElementById('scan-status-bar').style.width = etapas[step].p + "%";
                    document.getElementById('scan-text').innerText = etapas[step].t;
                    step++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        somIntroducao.pause();
                        somIntroducao.currentTime = 0;
                        if(somLoading) somLoading.pause();
                        document.getElementById('loading-screen').style.transition = "opacity 0.8s";
                        document.getElementById('loading-screen').style.opacity = "0";
                        setTimeout(() => { document.getElementById('loading-screen').style.display = "none"; }, 800);
                    }, 3000); 
                }
            }, 800);
        };
    });     
</script>
</body>
</html>
